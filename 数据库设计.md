# 数据库设计

简介：

​	简单来说，数据库设计就是根据业务系统的具体需要，结合我们所选用的 DBMS（数据库管理系统），为这个业务系统构造出最优的数据存储模型。并建立好数据库中的表结构及表与表之间的关联关系的过程。使之能有效的对应用系统中的数据进行存储，并可以高效的对已经存储的数据进行访问。

##### 为什么要进行数据库设计？

|    优良的设计    |           糟糕的设计           |
| :--------------: | :----------------------------: |
|   减少数据冗余   |        存在大量数据冗余        |
| 避免数据维护异常 | 存在数据插入，更新，删除等异常 |
|   节约存储空间   |        浪费大量存储空间        |
|    高效的访问    |          访问数据低效          |

##### 要搞清楚的问题

- 实体及实体之间的关系（1对1，1对多，多对多）。
- 实体所包含的属性有什么？
- 那些属性或属性的组合可以唯一标识一个实体

##### 逻辑设计是做什么的

1. 将需求转化为数据库的逻辑模型
2. 通过 ER 图的形式对逻辑模型进行展示
3. 同所选用的具体的 DBMS 系统无关

##### 名词解释

- 关系：一个关系对应通常所说的一张表。
- 元组：表中的一行即为一个元组。
- 属性：表中的一列即为一个属性，每一个属性都有一个名称，称为属性名。
- 候选码：表中的某个属性组，它可以唯一确定一个元组。
- 主码：一个关系有多个候选码，选定其中一个为主码。
- 域：属性的取值范围。
- 分量：元组中的一个属性值。

##### ER 图例说明

- 矩形：表示实体集，矩形内写实体集的名字
- 菱形：表示联系集
- 椭圆：表示实体的属性
- 线段：将属性连接到实体集，或将实体集连接到联系集

### 数据库设计范式

##### 常见的数据库设计范式

第一范式，第二范式，第三范式及 BC 范式，以及第四，第五范式。目前大多数数据库设计遵循的范式都是 第一、二、三 范式。

##### 操作异常

- 插入异常：如果某实体随着另一个实体的存在而存在，即缺少某个实体时无法表示这个实体，那么这个表就存在插入异常。
- 更新异常：如果更改表所对应的某个实例的单独属性时，需要将多行更新，那么就说这个表存在更新异常。
- 删除异常：如果删除表的某一行来反映某实体实例失效时导致另一个不同实体实例信息丢失，那么这个表中就存在删除异常。
- 数据冗余：是指相同的数据在多个地方存在，或者说表中的某个列可以由其它列计算得到，这样就说表中存在着数据冗余。

##### 第一范式（1NF）

定义：数据库表中的所有字段都是单一属性，不可再分的。

这个单一属性时由基本的数据类型锁构成的，如整数，浮点数，字符串，等。

换句话说：第一范式要求数据库中的表都是二维表。

| 用户ID |  用户名   | 密码 | 姓名 |    电话     |
| :----: | :-------: | :--: | :--: | :---------: |
|   1    | zhangsan3 | ***  | 张三 | 13011311234 |

##### 第二范式（2NF）

定义：数据库的表中不存在非关键字段对任一候选关键字段的部分函数依赖。

部分函数依赖 是指存在着组合关键字中的某一关键字决定非关键字的情况。

换句话说：所以单关键字段的表都符合第二范式。



不符合第二范式的表：

| 商品名称 | 供应商名称 | 价格 | 描述 | 重量 | 供应商电话 | 有效期 | 分类 |
| :------: | :--------: | :--: | :--: | :--: | :--------: | :----: | :--: |
|   可乐   |  饮料一厂  | 3.00 |      | 250g |   888888   | 2019.4 | 饮料 |
|   啤酒   |  饮料二厂  | 5.00 |      | 500g |   666666   | 2019.8 | 饮料 |

存在的问题：插入异常、删除异常、更新异常、数据冗余。



拆分为 符合第二范式的表：

商品表：

| 商品ID | 商品名称 | 价格 | 描述 | 重量 | 有效期 |
| :----: | :------: | :--: | :--: | :--: | :----: |
|   1    |   可乐   | 3.00 |      | 250g | 2019.4 |
|   2    |   啤酒   | 5.00 |      | 500g | 2019.8 |

供应商表：

| 供应商ID | 供应商名称 | 供应商电话 |
| :------: | :--------: | :--------: |
|    1     |  饮料一厂  |   888888   |
|    2     |  饮料二厂  |   666666   |

商品与供应商 关系表：

| 供应商ID | 商品ID |
| :------: | :----: |
|    1     |   1    |
|    2     |   2    |

##### 第三范式（3NF）

定义：第三范式是在第二范式的基础之上定义的，如果数据表中不存在非关键字字段，对任意候选关键字段的传递函数依赖则符合第三范式。



不符合第三范式的表：

| 商品名称 | 价格 | 商品描述 | 重量  | 有效期 |   分类   | 分类描述 |
| :------: | :--: | :------: | :---: | :----: | :------: | :------: |
|   可乐   | 3.00 |          | 250ml | 2019.5 | 酒水饮料 | 碳酸饮料 |
|   苹果   | 8.00 |          | 500g  | 2020.2 | 生鲜食品 |   水果   |



拆分为 符合第三范式的表：

商品表：

| 商品ID | 商品名称 | 价格 | 商品描述 | 重量  | 有效期 |
| :----: | :------: | :--: | :------: | :---: | :----: |
|   1    |   可乐   | 3.00 |          | 250ml | 2019.5 |
|   2    |   苹果   | 8.00 |          | 500g  | 2020.2 |

分类表：

| 分类ID | 分类名称 | 分类描述 |
| :----: | :------: | :------: |
|   1    | 酒水饮料 | 碳酸饮料 |
|   2    | 生鲜食品 |   水果   |

商品与分类 关系表：

| 分类ID | 商品ID |
| :----: | :----: |
|   1    |   1    |
|   2    |   2    |

##### BC范式（Boyce.Codd范式）（BCNF）

定义：

在第三范式的基础之上，数据库表中如果不存在任何字段对任一候选关键字段的传递函数依赖则符合 BC范式。

也就是说如果是复合关键字，则复合关键字之间也不能存在函数依赖关系。



不符合BC范式的表：

|  供应商  | 商品ID | 供应商联系人 | 商品数量 |
| :------: | :----: | :----------: | :------: |
| 饮料一厂 |   1    |     张三     |    10    |
| 饮料一厂 |   2    |     李四     |    20    |
| 饮料二厂 |   1    |     王五     |    20    |

存在下列关系，因此不符合 BCNF 要求：

（供应商）-> （供应商联系人）

（供应商联系人）-> （供应商）

并且存在数据操作异常及数据冗余。



拆分为 符合 BC范式 的表：

|  供应商  | 商品ID | 商品数量 |
| :------: | :----: | :------: |
| 饮料一厂 |   1    |    10    |
| 饮料一厂 |   2    |    20    |
| 饮料一厂 |   1    |    20    |

供应商信息表：

|  供应商  | 供应商联系人 |
| :------: | :----------: |
| 饮料一厂 |     张三     |
| 饮料一厂 |     李四     |
| 饮料二厂 |     王五     |



